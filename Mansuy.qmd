---
title: "Mansuy"
author: "No√© Mansuy"
format: html
---
Github repository : https://github.com/Noenmk/grades-eval.git

## 1 - Introduction

```{r}
library(here)
library(ggplot2)
library(vroom)
library(dplyr)
library(tidyr)
here::i_am("grades-eval.Rproj")
```
# Question 1

```{r}
courses <- vroom(here("courses.csv"))
```
# Question 2 
```{r}
courses_formatted_table <- courses |> 
  arrange(course) |> 
  select(
    'course name' = course,
    identifier = course_id,
    module = module,
    'number of exams' = nb_grades
  )
courses_formatted_table |> 
  knitr::kable()
```
# Question 3
```{r}
students <- vroom(
  here("students.csv"),
  col_types = cols(
    id = col_integer(),
    group = col_integer(), 
    birth_date = col_date(format = "%Y-%m-%d"), 
    sex = col_factor()
  )
)

print(paste("The birth_date column of the students data frame is of class",
            class(students$birth_date)))
print(paste("The sex column of the students data frame is of class",
            class(students$sex)))
```
# Question 4

```{r}
grades <- vroom(here("grades.csv"), 
  delim = ":", 
  na = "_", 
  col_types = cols(
    id = col_integer(),
    course_id = col_factor(),
    grade = col_double()
  )
)
```

## Student population analysis

# Question 5
```{r}
students |> 

  ggplot(aes(x = group)) + 
  
  geom_bar(fill = "steelblue") +
  
  labs(
    title = "Distribution of Students Across Groups",
    x = "Student Group ",
    y = "Number of Students"
  ) 
```

# Question 6

```{r}
students |>
  
  ggplot(aes(x = group, fill = sex)) +
  
 
  geom_bar(position = "fill") +
  
  labs(
    title = "Gender Balance by Student Group",
    x = "Student Group ",
    y = "Proportion of Students ",
    fill = "Gender"
  )
```
# Question 7


```{r}
library(lubridate)
students |>
  
  mutate(
    age_years = time_length(today() - birth_date, unit = "year")
  ) |>
  
  ggplot(aes(x = age_years)) +
  
  geom_histogram(fill = "darkgreen", color = "white") +
  
  labs(
    title = "Distribution of Student Age",
    x = "Age (Years)",
    y = "Number of Students"
  )
```
# Question 8


```{r}
# Juste le calcul
median_age_table <- students |>
  group_by(group) |> 
  mutate(
    age_years = time_length(today() - birth_date, unit = "year")
  ) |>
  summarize(
    median_age_int = floor(median(age_years, na.rm = TRUE))
  )

# Affichage du tableau proprement
median_age_table |>
  select(
    'Group Identifier' = group,
    'Median Age' = median_age_int
  ) |>
  knitr::kable()

```
# Question 9

```{r}

oldest_students <- students |>
  mutate(age = floor(time_length(today() - birth_date, unit = "year"))) |>
  
  group_by(group) |>
  slice_max(age, n = 1, with_ties = FALSE) |>
  
  select(id, sex, age) |>
  
  arrange(desc(age))
knitr::kable(oldest_students)

```
## Simple grade analysis

# Question 10

The data set grades contains `r sum(!is.na(grades$grade))` grades.

# Question 11

```{r}
combined_data <- grades |> 
  left_join(courses, by = "course_id") |>

  left_join(students, by = "id")

avg_grades_table <- combined_data |>
  
  filter(course == "Traditional Medicine and Herbalism") |>
  
  group_by(group) |>
  
  summarize(
    avg_grade = mean(grade, na.rm = TRUE)
  )

avg_grades_table |>
  mutate(group = factor(as.integer(as.character(group)), ordered = TRUE)) |>
  ggplot(aes(x = group, y = avg_grade)) + 
  geom_col(fill = "salmon", color = "white") +
  geom_hline(yintercept = mean(avg_grades_table$avg_grade, na.rm = TRUE), 
             linetype = "dashed", color = "grey20") +
  scale_y_continuous(limits = c(0, 20)) +  # <-- set y-axis from 0 to 20
  labs(
    title = "Average Grade in Traditional Medicine and Herbalism by Group",
    x = "Student Group",
    y = "Average Grade"
  )

  
```
# Question 12

## Attendance analysis

# Question 13
```{r}

grades_per_student <- grades |>
  group_by(id) |>
  summarize(num_grades = n(), .groups = "drop") |>
  left_join(students, by = c(id = "id")) |>
  select(id, group, sex, num_grades)

grades_per_student |>
  slice_head(n = 10) |>
  knitr::kable()

summary_table <- grades_per_student |>
  summarize(
    min = min(num_grades, na.rm = TRUE),
    max = max(num_grades, na.rm = TRUE),
    mean = mean(num_grades, na.rm = TRUE),
    median = median(num_grades, na.rm = TRUE)
  )

knitr::kable(summary_table)

```

# Question 14

```{r}
ggplot(grades_per_student, aes(x = num_grades, fill = sex)) +
  geom_histogram(position = "dodge", binwidth = 1, color = "white") +
  scale_x_continuous(breaks = 0:max(grades_per_student$num_grades)) +
  labs(
    title = "Distribution of Number of Grades by Sex and Number of Students",
    x = "Number of Grades",
    y = "Number of Students",
    fill = "Sex"
  )
```
# Question 15

```{r}
grades_arch_scul <- combined_data |>
  filter(course == "Architecture and Sculpture") |>
  group_by(id, group) |>  # include group in grouping
  summarize(num_grades = n(), .groups = "drop")  # keeps group automatically

# Show a small extract
grades_arch_scul |>
  slice_head(n = 5) |>
  knitr::kable()

```
# Question 16 

```{r}

grades_distribution <- grades_arch_scul |>
  group_by(num_grades) |>
  summarize(num_students = n(), .groups = "drop")

ggplot(grades_distribution, aes(x = num_grades, y = num_students)) +
  geom_col(fill = "steelblue", color = "white") +
  scale_x_continuous(breaks = grades_distribution$num_grades) + 
  labs(
    title = "Distribution of Number of Grades per Student\n(Architecture and Sculpture)",
    x = "Number of Grades",
    y = "Number of Students"
  ) +
  theme_minimal()


```
# Question 17

```{r}
library(ggplot2)

ggplot(grades_arch_scul, aes(x = factor(group), y = num_grades, fill = factor(group))) +
  geom_col() +
  labs(
    title = "Number of Grades in Architecture and Sculpture by Group",
    x = "Student Group",
    y = "Number of Grades",
    fill = "Group"
  ) +
  theme_minimal()

```
# Question 18 

```{r}

grades_arch_scul <- grades_arch_scul |>
  left_join(students |> select(id, sex), by = c("id" = "id"))


ggplot(grades_arch_scul, aes(x = factor(group), y = num_grades, fill = sex)) +
  geom_col() +
  labs(
    title = "Number of Grades in Architecture and Sculpture by Group and Sex",
    x = "Student Group",
    y = "Number of Grades",
    fill = "Sex"
  )

```
# Question 19

```{r}
avg_grades <- combined_data |>
  group_by(id, group, course) |>
  summarize(avg_grade = mean(grade, na.rm = TRUE), .groups = "drop")

grades_wide <- avg_grades |>
  pivot_wider(
    names_from = course,
    values_from = avg_grade
  )

grades_wide |>
  select(id, group, `Agriculture and Horticulture`, `Architecture and Sculpture`) |>
  slice_head(n = 5) |>
  knitr::kable()

```
# Question 20 
```{r}
ggplot(grades_wide, aes(
  x = `Language and Linguistics`,
  y = `Music and Dance`
)) +
  geom_bin2d(bins = 15) + 
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  labs(
    title = "2D Binned Average Grades: Music and Dance vs Language and Linguistics",
    x = "Average Grade in Language and Linguistics",
    y = "Average Grade in Music and Dance",
    fill = "Number of Students"
  ) +
  scale_x_continuous(limits = c(0, 20)) +
  scale_y_continuous(limits = c(0, 20)) +
  theme_minimal(base_size = 14)
```
# Question 21

```{r}
correlation_by_group <- grades_wide |>
  group_by(group) |>
  summarize(
    correlation = cor(
      `Astrology and Divination`,
      `Martial Arts and Self-Defense`,
      use = "complete.obs"
    ),
    .groups = "drop"
  )

correlation_by_group |>
  knitr::kable()

```
# Question 22

```{r}
correlation_by_group <- grades_wide |>
  group_by(group) |>
  summarize(
    correlation = cor(
      `Astrology and Divination`,
      `Martial Arts and Self-Defense`,
      use = "complete.obs"
    ),
    .groups = "drop"
  )

best_group <- correlation_by_group |>
  slice_max(order_by = abs(correlation), n = 1) |>
  pull(group)

grades_best_group <- grades_wide |>
  filter(group == best_group)

ggplot(grades_best_group, aes(
  x = `Astrology and Divination`,
  y = `Martial Arts and Self-Defense`
)) +
  geom_point(color = "steelblue", size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", se = FALSE, color = "darkred", linetype = "dashed") +
  labs(
    title = paste("Grades in Astrology vs Martial Arts\n(Group", best_group, ")"),
    x = "Average Grade in Astrology and Divination",
    y = "Average Grade in Martial Arts and Self-Defense"
  ) +
  scale_x_continuous(limits = c(0, 20)) +
  scale_y_continuous(limits = c(0, 20)) +
  theme_minimal(base_size = 14)


```
# Question 23

```{r}

final_grades <- grades_wide |>
  rowwise() |> 
  mutate(
    final_grade = mean(c_across(-c(id, group)), na.rm = TRUE)  
  ) |>
  ungroup() |>
  
  
  left_join(students |> select(id, sex), by = "id") |>
  select(id, group, sex, final_grade) |>
 
  arrange(desc(final_grade))


final_grades |>
  slice_head(n = 5) |>
  knitr::kable(digits = 2)

```
# Question 24

```{r}
library(dplyr)
library(knitr)

summary_by_group <- final_grades |>
  group_by(group) |>
  summarize(
    min = min(final_grade, na.rm = TRUE),
    max = max(final_grade, na.rm = TRUE),
    mean = mean(final_grade, na.rm = TRUE),
    median = median(final_grade, na.rm = TRUE),
    sd = sd(final_grade, na.rm = TRUE),
    .groups = "drop"
  )

summary_by_group |>
  knitr::kable(digits = 2)

```
# Question 25
```{r}
summary_by_group_sex <- final_grades |>
  group_by(group, sex) |>
  summarize(
    min = min(final_grade, na.rm = TRUE),
    max = max(final_grade, na.rm = TRUE),
    mean = mean(final_grade, na.rm = TRUE),
    median = median(final_grade, na.rm = TRUE),
    sd = sd(final_grade, na.rm = TRUE),
    .groups = "drop"
  )


summary_by_group_sex |>
  knitr::kable(digits = 2)

```















